Sub TrackEmailsFromSubjects()
    Dim OutlookApp As Object
    Dim OutlookNS As Object
    Dim Inbox As Object
    Dim SentItems As Object
    Dim Mail As Object
    Dim i As Long, rw As Long
    Dim SubjectToFind As String
    Dim Filter As String
    Dim Items As Object, Item As Object
    Dim LastResponder As String
    
    ' Create Outlook object
    On Error Resume Next
    Set OutlookApp = GetObject(, "Outlook.Application")
    If OutlookApp Is Nothing Then
        Set OutlookApp = CreateObject("Outlook.Application")
    End If
    On Error GoTo 0
    
    Set OutlookNS = OutlookApp.GetNamespace("MAPI")
    Set Inbox = OutlookNS.GetDefaultFolder(6) ' 6 = Inbox
    Set SentItems = OutlookNS.GetDefaultFolder(5) ' 5 = Sent Items
    
    ' Loop through Excel rows
    rw = 2 ' start row
    Do While Cells(rw, 1).Value <> ""
        SubjectToFind = Trim(Cells(rw, 1).Value)
        Filter = "@SQL=" & Chr(34) & "urn:schemas:mailheader:subject" & Chr(34) & " LIKE '%" & SubjectToFind & "%'"
        
        ' Search in Inbox
        Set Items = Inbox.Items.Restrict(Filter)
        Items.Sort "[ReceivedTime]", True
        
        If Items.Count = 0 Then
            ' If not found in Inbox, check Sent Items
            Set Items = SentItems.Items.Restrict(Filter)
            Items.Sort "[SentOn]", True
        End If
        
        If Items.Count > 0 Then
            Set Mail = Items(1) ' Most recent
            
            ' Sender
            On Error Resume Next
            Cells(rw, 2).Value = Mail.SenderName
            Cells(rw, 3).Value = Mail.Recipients(1).Name
            
            ' Body
            Cells(rw, 4).Value = Left(Mail.Body, 200) & "..."
            
            ' Attachments
            If Mail.Attachments.Count > 0 Then
                Cells(rw, 5).Value = "Yes"
            Else
                Cells(rw, 5).Value = "No"
            End If
            
            ' Last Responder
            LastResponder = Mail.SenderName
            Cells(rw, 6).Value = LastResponder
        Else
            Cells(rw, 2).Value = "Not Found"
        End If
        
        rw = rw + 1
    Loop
    
    MsgBox "Email tracking completed!", vbInformation
End Sub
