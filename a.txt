Sub TrackEmailsFromSubjects()
    Dim OutlookApp As Object
    Dim OutlookNS As Object
    Dim Inbox As Object
    Dim SentItems As Object
    Dim Mail As Object
    Dim rw As Long
    Dim SubjectToFind As String
    Dim Filter As String
    Dim Items As Object, SentMatches As Object
    Dim AllCount As Long
    Dim LastEmailTime As Date
    Dim LastResponder As String
    
    ' Create Outlook object
    On Error Resume Next
    Set OutlookApp = GetObject(, "Outlook.Application")
    If OutlookApp Is Nothing Then
        Set OutlookApp = CreateObject("Outlook.Application")
    End If
    On Error GoTo 0
    
    Set OutlookNS = OutlookApp.GetNamespace("MAPI")
    Set Inbox = OutlookNS.GetDefaultFolder(6) ' Inbox
    Set SentItems = OutlookNS.GetDefaultFolder(5) ' Sent Items
    
    rw = 2 ' Start row
    Do While Cells(rw, 1).Value <> ""
        SubjectToFind = Trim(Cells(rw, 1).Value)
        Filter = "@SQL=" & Chr(34) & "urn:schemas:mailheader:subject" & Chr(34) & " LIKE '%" & SubjectToFind & "%'"
        
        ' Search Inbox
        Set Items = Inbox.Items.Restrict(Filter)
        Items.Sort "[ReceivedTime]", True
        
        ' Search Sent Items
        Set SentMatches = SentItems.Items.Restrict(Filter)
        SentMatches.Sort "[SentOn]", True
        
        ' Count total matches
        AllCount = Items.Count + SentMatches.Count
        
        ' Find latest email time (Inbox vs Sent)
        LastEmailTime = 0
        If Items.Count > 0 Then
            If Items(1).ReceivedTime > LastEmailTime Then LastEmailTime = Items(1).ReceivedTime
        End If
        If SentMatches.Count > 0 Then
            If SentMatches(1).SentOn > LastEmailTime Then LastEmailTime = SentMatches(1).SentOn
        End If
        
        ' Pick most recent email for details
        If Items.Count > 0 And (SentMatches.Count = 0 Or Items(1).ReceivedTime >= SentMatches(1).SentOn) Then
            Set Mail = Items(1)
        ElseIf SentMatches.Count > 0 Then
            Set Mail = SentMatches(1)
        Else
            Set Mail = Nothing
        End If
        
        If Not Mail Is Nothing Then
            Cells(rw, 2).Value = Mail.SenderName
            Cells(rw, 3).Value = Mail.Recipients(1).Name
            Cells(rw, 4).Value = Left(Mail.Body, 200) & "..."
            Cells(rw, 5).Value = IIf(Mail.Attachments.Count > 0, "Yes", "No")
            LastResponder = Mail.SenderName
            Cells(rw, 6).Value = LastResponder
            Cells(rw, 7).Value = LastEmailTime
            Cells(rw, 8).Value = AllCount
        Else
            Cells(rw, 2).Value = "Not Found"
        End If
        
        rw = rw + 1
    Loop
    
    MsgBox "Email tracking completed!", vbInformation
End Sub
