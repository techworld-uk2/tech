Sub TrackEmailsFromSubjects()
    Dim OutlookApp As Object
    Dim OutlookNS As Object
    Dim Inbox As Object
    Dim SentItems As Object
    Dim Mail As Object
    Dim rw As Long
    Dim SubjectToFind As String
    Dim Filter As String
    Dim Items As Object, SentMatches As Object
    Dim AllCount As Long
    Dim LastEmailTime As Date
    Dim LastResponder As String
    
    ' Create Outlook object
    On Error Resume Next
    Set OutlookApp = GetObject(, "Outlook.Application")
    If OutlookApp Is Nothing Then
        Set OutlookApp = CreateObject("Outlook.Application")
    End If
    On Error GoTo 0
    
    Set OutlookNS = OutlookApp.GetNamespace("MAPI")
    Set Inbox = OutlookNS.GetDefaultFolder(6) ' Inbox
    Set SentItems = OutlookNS.GetDefaultFolder(5) ' Sent Items
    
    rw = 2 ' Start row
    Do While Trim(Cells(rw, 1).Value) <> ""
        SubjectToFind = Trim(Cells(rw, 1).Value)
        Filter = "@SQL=" & Chr(34) & "urn:schemas:mailheader:subject" & Chr(34) & " LIKE '%" & SubjectToFind & "%'"
        
        ' Search Inbox
        Set Items = Inbox.Items.Restrict(Filter)
        Items.Sort "[ReceivedTime]", True
        
        ' Search Sent Items
        Set SentMatches = SentItems.Items.Restrict(Filter)
        SentMatches.Sort "[SentOn]", True
        
        ' Count total matches
        AllCount = Items.Count + SentMatches.Count
        
        ' Default values
        LastEmailTime = 0
        Set Mail = Nothing
        
        ' Check for latest email from Inbox
        If Items.Count > 0 Then
            If Items(1).ReceivedTime > LastEmailTime Then
                LastEmailTime = Items(1).ReceivedTime
                Set Mail = Items(1)
            End If
        End If
        
        ' Check for latest email from Sent
        If SentMatches.Count > 0 Then
            If SentMatches(1).SentOn > LastEmailTime Then
                LastEmailTime = SentMatches(1).SentOn
                Set Mail = SentMatches(1)
            End If
        End If
        
        ' Write results
        If Not Mail Is Nothing Then
            Cells(rw, 2).Value = Mail.SenderName
            If Mail.Recipients.Count > 0 Then
                Cells(rw, 3).Value = Mail.Recipients(1).Name
            Else
                Cells(rw, 3).Value = ""
            End If
            Cells(rw, 4).Value = Left(Mail.Body, 200) & "..."
            Cells(rw, 5).Value = IIf(Mail.Attachments.Count > 0, "Yes", "No")
            Cells(rw, 6).Value = Mail.SenderName
            Cells(rw, 7).Value = LastEmailTime
            Cells(rw, 8).Value = AllCount
        Else
            Cells(rw, 2).Value = "Not Found"
            Cells(rw, 7).Value = ""
            Cells(rw, 8).Value = 0
        End If
        
        rw = rw + 1
    Loop
    
    MsgBox "Email tracking completed!", vbInformation
End Sub
